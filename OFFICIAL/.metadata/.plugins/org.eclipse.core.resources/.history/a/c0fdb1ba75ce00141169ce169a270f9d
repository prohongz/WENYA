package finalcut;

import java.awt.AWTException;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Rectangle;
import java.awt.Robot;
import java.awt.Toolkit;

import javax.imageio.ImageIO;
import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.border.EmptyBorder;
import javax.swing.GroupLayout;
import javax.swing.GroupLayout.Alignment;
import javax.swing.JOptionPane;
import javax.swing.LayoutStyle.ComponentPlacement;
import javax.swing.JButton;

import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.io.PrintWriter;

import Simulator.Constant;
import Simulator.DrawSim;
import Simulator.liveupdate;

import java.awt.GridLayout;

@SuppressWarnings("serial")
public class SimulatorWindow extends JFrame {

	private JPanel contentPane;
	int sscount;

	/**
	 * Create the frame.
	 */
	public SimulatorWindow() {
		setTitle("Wenya Industrial Simulator");
		setFont(new Font("Arial", Font.PLAIN, 12));
		setIconImage(Toolkit.getDefaultToolkit().getImage(StartUI.class.getResource("/misc/Icon.gif")));
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		setSize(1280, 720);
		setMinimumSize(new Dimension(1280, 720));
		Toolkit t = Toolkit.getDefaultToolkit();
        int x = (int)((t.getScreenSize().getWidth() - getWidth()) / 2);
        int y = (int)((t.getScreenSize().getHeight() - getHeight()) / 2);
        setLocation(x, y);
		contentPane = new JPanel();
		contentPane.setBorder(new EmptyBorder(5, 5, 5, 5));
		setContentPane(contentPane);
		
		//ADDING IN SIMULATOR THREAD
		JPanel panel = new JPanel();
		DrawSim Simu = new DrawSim();
		Simu.setPreferredSize(new Dimension(962, 639));
		Simu.start();
		
		
		JPanel realtimepanel = new JPanel();
		liveupdate realtime = new liveupdate();
		realtime.setPreferredSize(new Dimension(276, 639));
		realtime.start();
		
		JButton btnPause = new JButton("Pause");
		btnPause.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {				
				if (btnPause.getText() == "Pause"){
					btnPause.setText("Resume");
					
					//PROCEED TO PAUSE THE SIMULATOR
					Simu.suspend();
				}
				else{
					btnPause.setText("Pause");
					
					//PROCEED TO RESUME THE SIMULATOR
					Simu.resume();
				}
				
			}
		});
		
		JButton btnExit = new JButton("Exit");
		
		
		JButton btnScreenshot = new JButton("Screenshot");
		btnScreenshot.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent arg0) {
				File file = new File("src/Screen Capture");
				if (!file.exists()) {
					if (file.mkdir()) {
						System.out.println("Directory is created!");
					} else {
						System.out.println("Failed to create directory!");
					}
				}
				// capture the whole screen
				BufferedImage image;
				File file1 = new File("src/Screen Capture/screencapture" + sscount + ".jpg");
				try {
					image = new Robot().createScreenCapture( 
							new Rectangle( getX(), getY(), getWidth(), getHeight() ) );
					ImageIO.write(image, "jpg", file1);
				} catch (AWTException | IOException e1) {
					// TODO Auto-generated catch block
					e1.printStackTrace();
				}
				sscount++;
			}
		});
		
		JPanel timepanel = new JPanel();
		
		JButton button = new JButton("<<");
		button.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent arg0) {
				if(Constant.tsleep_ms < 200)
					Constant.tsleep_ms+=10;
			}
		});
		
		JButton button_1 = new JButton(">>");
		button_1.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent arg0) {
				if(Constant.tsleep_ms > (-100)){
					Constant.tsleep_ms-=10;
					System.out.print(Constant.tsleep_ms);
				}		
			}
		});
		GroupLayout gl_timepanel = new GroupLayout(timepanel);
		gl_timepanel.setHorizontalGroup(
			gl_timepanel.createParallelGroup(Alignment.LEADING)
				.addGroup(gl_timepanel.createSequentialGroup()
					.addContainerGap()
					.addComponent(button)
					.addPreferredGap(ComponentPlacement.RELATED)
					.addComponent(button_1)
					.addContainerGap(168, Short.MAX_VALUE))
		);
		gl_timepanel.setVerticalGroup(
			gl_timepanel.createParallelGroup(Alignment.LEADING)
				.addGroup(gl_timepanel.createSequentialGroup()
					.addGroup(gl_timepanel.createParallelGroup(Alignment.BASELINE)
						.addComponent(button)
						.addComponent(button_1))
					.addContainerGap(GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
		);
		timepanel.setLayout(gl_timepanel);
		
		GroupLayout gl_contentPane = new GroupLayout(contentPane);
		gl_contentPane.setHorizontalGroup(
			gl_contentPane.createParallelGroup(Alignment.LEADING)
				.addGroup(gl_contentPane.createSequentialGroup()
					.addGroup(gl_contentPane.createParallelGroup(Alignment.LEADING)
						.addGroup(gl_contentPane.createSequentialGroup()
							.addComponent(timepanel, GroupLayout.PREFERRED_SIZE, 128, GroupLayout.PREFERRED_SIZE)
							.addGap(885)
							.addComponent(btnScreenshot)
							.addGap(6)
							.addComponent(btnPause, GroupLayout.PREFERRED_SIZE, 71, GroupLayout.PREFERRED_SIZE)
							.addGap(6)
							.addComponent(btnExit, GroupLayout.PREFERRED_SIZE, 61, GroupLayout.PREFERRED_SIZE))
						.addGroup(gl_contentPane.createSequentialGroup()
							.addComponent(panel, GroupLayout.PREFERRED_SIZE, 962, GroupLayout.PREFERRED_SIZE)
							.addPreferredGap(ComponentPlacement.UNRELATED)
							.addComponent(realtimepanel, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
					.addContainerGap())
		);
		gl_contentPane.setVerticalGroup(
			gl_contentPane.createParallelGroup(Alignment.LEADING)
				.addGroup(gl_contentPane.createSequentialGroup()
					.addGroup(gl_contentPane.createParallelGroup(Alignment.LEADING)
						.addComponent(realtimepanel, GroupLayout.DEFAULT_SIZE, 642, Short.MAX_VALUE)
						.addComponent(panel, Alignment.TRAILING, GroupLayout.DEFAULT_SIZE, 642, Short.MAX_VALUE))
					.addPreferredGap(ComponentPlacement.RELATED)
					.addGroup(gl_contentPane.createParallelGroup(Alignment.LEADING)
						.addComponent(btnScreenshot)
						.addComponent(btnPause)
						.addComponent(btnExit)
						.addComponent(timepanel, GroupLayout.PREFERRED_SIZE, 23, GroupLayout.PREFERRED_SIZE))
					.addContainerGap())
		);
		panel.setLayout(new GridLayout(0, 1, 0, 0));
		GroupLayout gl_Simu = new GroupLayout(Simu);
		gl_Simu.setHorizontalGroup(
			gl_Simu.createParallelGroup(Alignment.LEADING)
				.addGap(0, 952, Short.MAX_VALUE)
		);
		gl_Simu.setVerticalGroup(
			gl_Simu.createParallelGroup(Alignment.LEADING)
				.addGap(0, 628, Short.MAX_VALUE)
		);
		Simu.setLayout(gl_Simu);
		panel.add(Simu);
		realtimepanel.setLayout(new GridLayout(0, 1, 0, 0));
		realtimepanel.add(realtime);
		contentPane.setLayout(gl_contentPane);
		
		//EXIT BUTTON ACTION
		btnExit.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
				JFrame frame = null;
				int n = JOptionPane.showConfirmDialog(
					    frame,
					    "Are you sure you want to quit the Simulation?",
					    "Wenya Industrial Simulator",
					    JOptionPane.YES_NO_OPTION);
				
				if(n == JOptionPane.YES_OPTION){
					
					File file = new File("src/Datafiles");
					if (!file.exists()) {
						if (file.mkdir()) {
							System.out.println("Directory is created!");
						} else {
							System.out.println("Failed to create directory!");
						}
					}
					
					
					
					//PROCEED TO SAVE ALL THE DATA INTO A NOTE FILE
					
					
					
					
					
					
					
					
					
					Simu.stop();
					realtime.stop();
					setVisible(false);
					dispose();
				}	
			}
		});
	}
}
